sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/ws/WebSocket","sap/m/FeedListItem","sap/ui/core/format/DateFormat"],function(e,t,s,n,a){"use strict";return e.extend("com.abapzombie.ZombieChannelChat.controller.Chat"+
,{onInit:function(){this.getView().setModel(new t({connectedUsers:[]}),"user");this._setChatWindowScroll();this._setMessageInputKeydown();this._setWebSocket()},_setChatWindowScroll:function(){var e=this.byId("chatWindow");e.addEventDelegate({onAfterRende+
ring:function(){var t=e.getContent();if(t.length>0){var s=t.pop().$();e.scrollTo(s.position().top+s.outerHeight())}}},this)},_setMessageInputKeydown:function(){this.byId("message").attachBrowserEvent("keydown",function(e){if(e.which===9){e.preventDefault+
()}})},_setWebSocket:function(){var e="/sap/bc/apc/sap/zchat?"+jQuery.param({avatar:Math.floor(Math.random()*sap.ui.core.IconPool.getIconNames().length)});this._wsChat=new s(e);this._wsChat.attachMessage(this.onMessage,this)},onSend:function(){var e=this+
.byId("message"),t=e.getValue();if(t){this._wsChat.send(t)}e.setValue("")},_getAvatar:function(e){var t=this.getView().getModel("user").getProperty("/connectedUsers"),s=t.find(function(t){return t.id===e});return s?"sap-icon://"+sap.ui.core.IconPool.getI+
conNames()[s.avatar]:""},onMessage:function(e){var t=JSON.parse(e.getParameter("data")),s=this.getView().getModel("user"),o=this.byId("chatWindow");if(t.connectedUsers){s.setProperty("/connectedUsers",t.connectedUsers)}if(t.message){var i=a.getDateTimeIn+
stance({UTC:true}),r=i.parse(t.message.timestamp);o.addContent(new n({icon:this._getAvatar(t.message.sender),iconActive:false,sender:t.message.sender,senderActive:false,text:t.message.text,timestamp:r.toLocaleString()}))}},onExit:function(){this._wsChat.+
close()}})});                                                                                                                                                                                                                                                  